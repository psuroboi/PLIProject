 /* RCBBUCM - UPDATE FOR RCBV0475_CTRY_COND                          */ 00011015
 /*                                                                  */ 00020014
 /* 5695-153 (C) COPYRIGHT IBM EMEA WORLD TRADE CORPORATION 1991     */ 00030014
 /* LICENSED MATERIAL - PROGRAM PROPERTY OF IBM                      */ 00040014
 /* REFER TO COPYRIGHT INSTRUCTIONS: FORM G120-2083                  */ 00050014
 /*                                                                  */ 00060014
 /********************************************************************/ 00070014
 /* PROGRAM          : RCBBUCP                                       */ 00080014
 /*                                                                  */ 00090014
 /* LANGUAGE         : PLI                                           */ 00100014
 /*                                                                  */ 00110014
 /* DATE GENERATED   : 10 JAN 2002 - 15:59:36                        */ 00120014
 /*                                                                  */ 00130014
 /* GENERATED BY     : RCBB1PZ0 - GENERATE UPDATE PROGRAM            */ 00140014
 /*                                                                  */ 00150014
 /* TYPE             : BMP                                           */ 00160014
 /*                                                                  */ 00170014
 /* DESCRIPTION      : UPDATE FOR RCBV0475_CTRY_COND                 */ 00180014
 /*                    THE UPDATE PROCESS IS OF TYPE 1,              */ 00190014
 /*                    NO DATE INVOLVED IN UPDATE PROCESS            */ 00200014
 /*                                                                  */ 00210014
 /* INPUT            : - DB2   : RCBV0475_CTRY_COND                  */ 00220014
 /*                              RCBV0500_PARM                       */ 00230014
 /*                    - FILES : ACTIONS  RCBBUC0                    */ 00240014
 /*                              PROCID   RCBPROC                    */ 00250014
 /*                                                                  */ 00260014
 /* OUTPUT           : - DB2   : RCBV0475_CTRY_COND                  */ 00270014
 /*                    - FILES : MESSAGE  RCB0M1F0                   */ 00280014
 /*                                                                  */ 00290014
 /* EXTERNAL MODULES : - RCB0E1M   COMMON ERROR ROUTINE              */ 00300014
 /*                    - RCB0M1M   COMMON MESSAGE ROUTINE            */ 00310014
 /*                    - RCB0T1M   SYSTEM DATE                       */ 00320014
 /*                    - RCB018M   CALCULATE HASH TOTALS             */ 00330014
 /*                    - RCBF85M   INSERT BUILDING BLOCK             */ 00340014
 /*                    - RCBG85M   UPDATE BUILDING BLOCK             */ 00350014
 /*                    - RCBH85M   DELETE BUILDING BLOCK             */ 00360014
 /*                    - RCBI50M   REFERENCE PARAMETER               */ 00370014
 /*                    - RCB024M   LOCK DB2 TABLE PARTITIONS RC01219 */ 00380014
 /*                                                                  */ 00390014
 /* MESSAGES         : 0001,0003,0007,0013,...,0019,0021,0148,       */ 00400014
 /*                    0163,0174,0175,0183,I050,9998,9999            */ 00410014
 /*                                                                  */ 00420014
 /*                                                                  */ 00430014
 /*                                                                  */ 00440014
 /* NOTE : THE ACTION FILE WILL FIRST BE PRE-PROCESSED IN ORDER      */ 00450014
 /*        TO CHECK THE HASH TOTALS BEFORE ACTUALLY UPDATING THE     */ 00460014
 /*        CEDS TABLES. FIRST THE FILE WILL BE SEQUENTIALLY READ     */ 00470014
 /*        AND PER COUNTRY THE HASH TOTALS WILL BE CALCULATED AND    */ 00480014
 /*        STORED IN WRK_HASH_AREA. THEY HAVE TO BE STORED THERE     */ 00490014
 /*        TEMPORARY AND CAN BE CHECKED AGAINST RCB024 AFTER AN      */ 00500014
 /*        XRST CALL HAS BEEN DONE. (BEFORE AN XRST CALL NO SQL      */ 00510014
 /*        STATEMENTS CAN BE ISSUED, AFTER AN XRST CALL NO SEQ. PLI  */ 00520014
 /*        READ CAN BE DONE ANYMORE, BECAUSE THEN THE POSITION IN    */ 00530014
 /*        THE FILE WILL BE LOST).                                   */ 00540014
 /*                                                                  */ 00550014
 /*                                                                  */ 00560014
 /* THE FOLLOWING EXCEPTION ROUTINES HAVE BEEN APPLIED DURING        */ 00570014
 /* GENERATION :  0                                                  */ 00580014
 /*                                                                  */ 00590014
 /* MAINTENANCE LOG  :                                               */ 00600014
 /* ---------------                                                  */ 00610014
 /*                                                                  */ 00620014
 /* DATE       | WORK-ITEMNO. | DESCRIPTION                          */ 00630014
 /* ---------------------------------------------------------------  */ 00640014
 /* 1992-03-02 | ----         | CEDS FIRST IMPLEMENTATION            */ 00650014
 /* 1992-07-20 | CED0001      | QF A1: HASH TOTAL & TIMESTAMP CHECK  */ 00660014
 /* 1992-09-15 | CED0002      | APG FIX (DC/DK FOR EMEA AND APG)     */ 00670014
 /* 1993-02-15 | RC1032       | MCO                                  */ 00680014
 /* 1993-08-13 | PTM 381      | SEE PTM DESCRIPTION                  */ 00690014
 /* 1994-05-27 | PTM 519      | SEE PTM DESCRIPTION                  */ 00700014
 /* 1995-08-07 | RB01140      | TABLE CHANGES       (DG)             */ 00710014
 /*            | RB01140      | IMPROVE PERFORMANCE (DG)             */ 00720014
 /*            | RC01141      | FILL SEQUENCE_KEY   (DG)             */ 00730014
 /*            | RC01141      | MESSAGE CHANGE      (DG)             */ 00740014
 /* 1997-04-09 | PTM1036      | USE STANDARD PROLOG                  */ 00750014
 /* 1997-06-11 | PTM1005      | CHANGE CHECKPOINT_LENGTH TO 30       */ 00760014
 /* 1998-02-27 | PTM1160      | OU_CODE DEFAULT FOR ITALY            */ 00770014
 /* 1999-02-24 | PTM1251      | CHECK OU WHEN 'INSERT' RECORDS SHOULD*/ 00780014
 /*            |              | BE 'UPDATE' RECORDS                  */ 00790014
 /* 1999-07-28 | RC01219      | DORO                                 */ 00800014
 /* 2009-04-06 | RB01299      | CEDS ALIGNMENT TO CHIS 810           */ 00810014
 /********************************************************************/ 00820014
1RCBBUCM: PROC    (PTR_PCB_IO,                    /* PCB PTR         */ 00830014
                   PTR_RCBBUC0)                   /* GSAM FILE PTR   */ 00840014
          OPTIONS (MAIN)                                                00850014
          REORDER;                                                      00860014
0/********************************************************************/ 00870014
 /*  PARAMETERS                                                      */ 00880014
 /********************************************************************/ 00890014
0DCL PTR_PCB_IO              PTR;                                       00900014
 DCL PTR_RCBBUC0             PTR;                                       00910014
0/********************************************************************/ 00920014
 /* FILE DECLARATIONS                                                */ 00930014
 /********************************************************************/ 00940014
 DCL RCBBUC0        FILE             /* INPUT ACTION FILE            */ 00950014
                    RECORD                                              00960014
                    INPUT;                                              00970014
 DCL RCBPROC        FILE             /* INPUT CARD FOR PROC_ID       */ 00980014
                    RECORD                                              00990014
                    INPUT;                                              01000014
0/********************************************************************/ 01010014
 /* EXTERNAL ENTRIES                                                 */ 01020014
 /********************************************************************/ 01030014
0DCL PLIXOPT   VAR    EXTERNAL  CHAR (256)                              01040014
               INIT ('NOSTAE,ISA(32K),REPORT,HEAP(16K,ANYWHERE)');      01050014
 DCL PLITDLI   ENTRY  EXTERNAL;                                         01060014
0DCL RCB0E1M   ENTRY  EXTERNAL;      /* COMMON ERROR ROUTINE         */ 01070014
 DCL RCB0M1M   ENTRY  EXTERNAL;      /* COMMON MESSAGE ROUTINE       */ 01080014
 DCL RCB0T1M   ENTRY  EXTERNAL;      /* RETRIEVE SYSTEM DATE         */ 01090014
 DCL RCB018M   ENTRY  EXTERNAL;      /* CALCULATE HASH TOTALS        */ 01100014
 DCL RCBF85M   ENTRY  EXTERNAL;      /* INSERT BUILDING BLOCK        */ 01110014
 DCL RCBG85M   ENTRY  EXTERNAL;      /* UPDATE BUILDING BLOCK        */ 01120014
 DCL RCBH85M   ENTRY  EXTERNAL;      /* DELETE BUILDING BLOCK        */ 01130014
 DCL RCBI50M   ENTRY  EXTERNAL;      /* REFERENCE PARAMETER          */ 01140014
 DCL RCB024M   ENTRY  EXTERNAL;      /* LOCK DB2 TABLE PARTITION     */ 01150014
0/********************************************************************/ 01160014
 /* EXTERNAL PARAMETER INTERFACES                                    */ 01170014
 /********************************************************************/ 01180014
0DCL PTR_INT_AREA     PTR;                                              01190014
 DCL PTR_RET_AREA_BB  PTR;                                              01200014
0DCL 1 PARM_INT_AREA,                                                   01210014
       %INCLUDE (RCBZ01S);;                                             01220014
 DCL 1 PARM_RET_AREA_BB,                                                01230014
       %INCLUDE (RCBZ02S);;                                             01240014
 DCL 1 PARM_RCB024M,                           /* RCB024M PARM       */ 01250014
      %INCLUDE (RCBZ33S);;                                              01260014
1/********************************************************************/ 01270014
 /*  IMS CONSTANTS                                                   */ 01280014
 /********************************************************************/ 01290014
0DCL 1 IMS_CONSTANTS,                                                   01300014
       %INCLUDE (RCBZ04S);;                                             01310014
0/********************************************************************/ 01320014
 /*  IMS CHECKPOINT/RESTART/ROLLBACK FIELDS                          */ 01330014
 /********************************************************************/ 01340014
0DCL CHKP_CNT_STEPS FIXED BIN (31);                                     01350014
 DCL CHKP_LEN_IO    FIXED BIN (31) INIT (30);                           01360014
 DCL CHKP_LEN_AREA  FIXED BIN (31);                                     01370014
0DCL 1 CHKP_ID,                                                         01380014
       %INCLUDE (RCBZ11S);;          /* SOURCE INFO FOR CHKP_ID      */ 01390014
 DCL 1 CHKP_XRST,                                                       01400014
       %INCLUDE (RCBZ12S);;          /* SOURCE INFO FOR CHKP_XRST    */ 01410014
 DCL 1 CHKP_AREA,                                                       01420014
       %INCLUDE (RCBZ14S);,          /* SOURCE INFO FOR CHKP_AREA    */ 01430014
       2 COUNT,                                                         01440014
         3 CNT_CTRY,                                                    01450014
 /*        5 ACTIONS       FIXED BIN(31),             /* SOC RB01299 */ 01460014
 /*        5 UPDATES       FIXED BIN(31),                            */ 01470014
 /*        5 DELETES       FIXED BIN(31),                            */ 01480014
 /*        5 INSERTS       FIXED BIN(31),                            */ 01490014
 /*        5 SKIPPED       FIXED BIN(31),                            */ 01500014
           5 ACTIONS       FIXED DEC(15,0),                             01510014
           5 UPDATES       FIXED DEC(15,0),                             01520014
           5 DELETES       FIXED DEC(15,0),                             01530014
           5 INSERTS       FIXED DEC(15,0),                             01540014
           5 SKIPPED       FIXED DEC(15,0),           /* EOC RB01299 */ 01550014
         3 CNT_TOT,                                                     01560014
 /*        5 ACTIONS       FIXED BIN(31),             /* SOC RB01299 */ 01570014
 /*        5 UPDATES       FIXED BIN(31),                            */ 01580014
 /*        5 DELETES       FIXED BIN(31),                            */ 01590014
 /*        5 INSERTS       FIXED BIN(31),                            */ 01600014
 /*        5 SKIPPED       FIXED BIN(31),                            */ 01610014
           5 ACTIONS       FIXED DEC(15,0),                             01620014
           5 UPDATES       FIXED DEC(15,0),                             01630014
           5 DELETES       FIXED DEC(15,0),                             01640014
           5 INSERTS       FIXED DEC(15,0),                             01650014
           5 SKIPPED       FIXED DEC(15,0),           /* EOC RB01299 */ 01660014
       2 KEY_VALUES,                                                    01670014
         3 CTRYNO          CHAR(03);                                    01680014
0/********************************************************************/ 01690014
 /* IMS PCB STRUCTURES                                               */ 01700014
 /********************************************************************/ 01710014
0DCL 1 PCB_IO         BASED (PTR_PCB_IO),                               01720014
       %INCLUDE (RCBZ16S);;                                             01730014
 DCL 1 PCB_RCBBUC0    BASED (PTR_RCBBUC0),                              01740014
       %INCLUDE (RCBZ10S);;                                             01750014
0/********************************************************************/ 01760014
 /* DB2 TABLE STRUCTURES                                             */ 01770014
 /********************************************************************/ 01780014
0DCL RCB475S_PTR        PTR;                                            01790014
 DCL RCB475SI_PTR       PTR;                                            01800014
 DCL RCBV500_PTR        PTR;                                            01810014
 DCL RCBV500I_PTR       PTR;                                            01820014
0DCL 1 RCB475S,                                                         01830014
       %INCLUDE (RCB475S);;                                             01840014
 DCL 1 RCB475SI,                                                        01850014
       %INCLUDE (RCB475SI);;                                            01860014
0DCL 1 TB_RCBV500,                                                      01870014
       %INCLUDE (RCB500S);;                                             01880014
 DCL 1 TB_RCBV500_I,                                                    01890014
       %INCLUDE (RCB500SI);;                                            01900014
 DCL 1 TB_RCBP12S             BASED (RCBV500_PTR),                      01910014
       %INCLUDE (RCBP12S);;                                             01920014
 DCL 1 TB_RCBP24S             BASED (RCBV500_PTR),                      01930014
       %INCLUDE (RCBP24S);;                                             01940014
0/********************************************************************/ 01950014
 /*  RECORD STRUCTURES FOR INPUT FILES                               */ 01960014
 /********************************************************************/ 01970014
0DCL 1 RCBBUC0_IOAREA              CHAR(221);                           01980014
 DCL 1 RCBBUC0_HEADER              BASED (ADDR (RCBBUC0_IOAREA)),       01990014
       %INCLUDE (RCBBAASH);;                                            02000014
 DCL 1 RCBBUC0_TRAILER             BASED (ADDR (RCBBUC0_IOAREA)),       02010014
       %INCLUDE (RCBBMAST);;                              /* RB01299 */ 02020014
 /*    %INCLUDE (RCBBAAST);;                              /* RB01299 */ 02030014
 DCL 1 RCBBUC0_RECORD              BASED (ADDR (RCBBUC0_IOAREA)),       02040014
       %INCLUDE (RCBBAAS2);,                                            02050014
       3 RCB475S,                                                       02060014
         %INCLUDE (RCB475S);,                                           02070014
       3 RCB475SI,                                                      02080014
         %INCLUDE (RCB475SI);;                                          02090014
 DCL 1 RCBPROC_REC,                                                     02100014
       %INCLUDE (RCBZ27S);;                                             02110014
0/********************************************************************/ 02120014
 /*  PROGRAM CONTROL PARAMETERS                                      */ 02130014
 /********************************************************************/ 02140014
 DCL 1 RCBP12S,                                                         02150014
       %INCLUDE (RCBP12S);;                                             02160014
 DCL 1 RCBP24S,                                                         02170014
       %INCLUDE (RCBP24S);;                                             02180014
0/********************************************************************/ 02190014
 /*  COUNTS                                                          */ 02200014
 /********************************************************************/ 02210014
0DCL CNT_HASH_TOTAL       FIXED DEC (15,0) INIT (0);                    02220014
 DCL CNT_PIC9             PIC '(09)9';                                  02230014
 DCL CNT_PIC15            PIC '(15)9';                                  02240014
0/********************************************************************/ 02250014
 /*  LOOP CONTROL FIELDS                                             */ 02260014
 /********************************************************************/ 02270014
0DCL 1 SSK,                          /* SMALLEST SORT KEY            */ 02280014
      3 EOF                  CHAR(1)      INIT('0'),                    02290014
      3 REC_TYPE             CHAR(2),                                   02300014
      3 CTRYNO               CHAR(3),                                   02310014
      3 COUNTRY_NUMBER       CHAR(3),                                   02320014
      3 SERVICE_LVL_CODE     CHAR(3),                                   02330014
      3 END                  CHAR(0);                                   02340014
0DCL 1 PREV_SSK           LIKE SSK;                                     02350014
0/********************************************************************/ 02360014
 /*  BIT SWITCHES                                                    */ 02370014
 /********************************************************************/ 02380014
0DCL TRUE                  BIT (1)         INIT ('1'B);                 02390014
 DCL FALSE                 BIT (1)         INIT ('0'B);                 02400014
 DCL SWITCH_EOF_RCBPROC    BIT (1)         INIT ('0'B);                 02410014
0/********************************************************************/ 02420014
 /*  ALL OTHER USED TEMPORARY FIELDS                                 */ 02430014
 /********************************************************************/ 02440014
0DCL 1 WRK_FIELDS,                                                      02450014
       3 WRK_MOD_NAME       CHAR (08),                                  02460014
       3 WRK_PGM_NAME       CHAR (08),                                  02470014
       3 WRK_SYSTEM_TYPE    CHAR (01) INIT ('I'),                       02480014
       3 WRK_HASH_FIELD     CHAR (04),                                  02490014
       3 WRK_TIME_STAMP     CHAR (20),                                  02500014
       3 WRK_SOURCE_IND     CHAR (01),                                  02510014
       3 WRK_RCBBUC0        CHAR (07) INIT ('RCBBUC0'),                 02520014
       3 WRK_CHKP_LIMIT     PIC '(9)9',                                 02530014
       3 WRK_CURR_DATE      CHAR (10),                                  02540014
       3 WRK_DIM            FIXED BIN (15,0),                           02550014
       3 WRK_IDX            FIXED BIN (15,0);                           02560014
 DCL 1 WRK_RCBZ29S,                                                     02570014
       %INCLUDE (RCBZ29S);;                                             02580014
0DCL 1 WRK_HASH_AREA,                                                   02590014
       %INCLUDE (RCBZ30S);;                                             02600014
0/********************************************************************/ 02610014
 /*  BUILTIN FUNCTIONS                                               */ 02620014
 /********************************************************************/ 02630014
0DCL (ADDR,                                                             02640014
      NULL,                                                             02650014
      LOW,                                                              02660014
      DIM,                                                              02670014
      STORAGE,                                                          02680014
      STRING,                                                           02690014
      SUBSTR,                                                           02700014
      VERIFY)  BUILTIN;                                                 02710014
0/********************************************************************/ 02720014
 /* ON ENDFILE CONDITIONS                                            */ 02730014
 /********************************************************************/ 02740014
0ON ENDFILE (RCBBUC0)                                                   02750014
    BEGIN;                                                              02760014
      SSK.EOF = '1';                                                    02770014
    END;                                                                02780014
 ON ENDFILE (RCBPROC)                /*   INPUT CARD                 */ 02790014
    BEGIN;                                                              02800014
     SWITCH_EOF_RCBPROC = TRUE;                                         02810014
    END;                                                                02820014
0/********************************************************************/ 02830014
 /* ON ERROR CONDITIONS                                              */ 02840014
 /********************************************************************/ 02850014
0%INCLUDE (RCB0E0M);                                                    02860014
   END;                                                                 02870014
0/********************************************************************/ 02880014
 /* DB2/SQL SQLCA                                                    */ 02890014
 /********************************************************************/ 02900014
0EXEC SQL                                                               02910014
   INCLUDE SQLCA                                                        02920014
   ;                                                                    02930014
1/********************************************************************/ 02940014
 /*                 S T A R T   P R O C E S S I N G                  */ 02950014
 /********************************************************************/ 02960014
0CALL RCBBUCM_INIT_PROGRAM;                                             02970014
                                                                        02980014
1/********************************************************************/ 02990014
 /*                 S T A R T   P R E  -  P R O C E S S I N G        */ 03000014
 /********************************************************************/ 03010014
0CALL RCBBUCM_PRE_INIT;                                                 03020014
0DO WHILE (RCBBUC0_RECORD.REC_TYPE ¬= '99' &        /* WHILE NOT EOF */ 03030014
           SSK.EOF ¬= '1');                                             03040014
                                                                        03050014
   CALL RCBBUCM_PRE_INIT_COUNTRY;                                       03060014
                                                                        03070014
0  DO WHILE (SUBSTR (STRING (PREV_SSK), 1, 6)  /* WHILE SAME COUNTRY */ 03080014
             = SUBSTR (STRING (SSK), 1, 6));                            03090014
     CALL RCBBUCM_PRE_PROCESS;                                          03100014
     CALL RCBBUCM_PRE_READ_FILE;                                        03110014
   END;                                                                 03120014
                                                                        03130014
   CALL RCBBUCM_PRE_END_COUNTRY;                                        03140014
0END;                                                                   03150014
0CALL RCBBUCM_PRE_END;                                                  03160014
                                                                        03170014
                                                                        03180014
0CALL RCBBUCM_CHKP_RESTART;                                             03190014
0IF CHKP_AREA.CNT_NUM = 1            /* NORMAL START                 */ 03200014
 THEN                                                                   03210014
   DO;                               /* OPEN FILES                   */ 03220014
     CALL RCBBUCM_OPEN_FILE_RCBBUC0;                                    03230014
     CALL RCBBUCM_READ_FILE_RCBBUC0;       /* READ HEADER RECORD     */ 03240014
     CALL RCBBUCM_READ_FILE_RCBBUC0;       /* READ FIRST DATA RECORD */ 03250014
   END;                                                                 03260014
                                                                        03270014
 CALL RCBBUCM_CHECK_HASH;            /* CHECK HASH TOTAL & TIMESTAMP */ 03280014
 /* RC01219: MOVE RCBBUCM_LOCK_TABLE CALL TO RCBBUCM_INIT_COUNTRY    */ 03290014
                                                                        03300014
1/********************************************************************/ 03310014
 /*                 S T A R T   U P D A T I N G                      */ 03320014
 /********************************************************************/ 03330014
0DO WHILE (RCBBUC0_RECORD.REC_TYPE ¬= '99' &        /* WHILE NOT EOF */ 03340014
           SSK.EOF ¬= '1');                                             03350014
                                                                        03360014
0  CALL RCBBUCM_INIT_COUNTRY;                                           03370014
                                                                        03380014
0  DO WHILE (SUBSTR (STRING (PREV_SSK), 1, 6)  /* WHILE SAME COUNTRY */ 03390014
             = SUBSTR (STRING (SSK), 1, 6));                            03400014
     COUNT.CNT_CTRY.ACTIONS = COUNT.CNT_CTRY.ACTIONS + 1;               03410014
     CALL RCBBUCM_INIT_ACTION;                                          03420014
                                                                        03430014
         CALL RCBBUCM_ISSUE_ACTION_MESSAGE;                             03440014
         SELECT (RCBBUC0_RECORD.ACTION_IND);                            03450014
                                                                        03460014
           WHEN ('I') DO;                                               03470014
             CALL RCBBUCM_INSERT;                                       03480014
             END;                                                       03490014
                                                                        03500014
           WHEN ('U') DO;                                               03510014
             CALL RCBBUCM_UPDATE;                                       03520014
             END;                                                       03530014
                                                                        03540014
           WHEN ('D') DO;                                               03550014
             CALL RCBBUCM_DELETE;                                       03560014
             END;                                                       03570014
                                                                        03580014
           OTHERWISE                                                    03590014
             DO;                                                        03600014
               CALL RCBBUCM_ISSUE_INV_ACTION;                           03610014
               CALL RCBBUCM_ERROR (NULL(),            /* ABEND       */ 03620014
                                  'OTHER',                              03630014
                                  '#001');                              03640014
             END;                                                       03650014
         END;   /* SELECT */                                            03660014
                                                                        03670014
0    IF RCBP12S.CHKP_LIMIT ¬= 0 & (CHKP_CNT_STEPS > RCBP12S.CHKP_LIMIT) 03680014
     THEN                                                               03690014
       DO;                                                              03700014
         CALL RCBBUCM_CHKP_ISSUE;                                       03710014
       END;                                                             03720014
0    CALL RCBBUCM_READ_FILE_RCBBUC0;       /* READ NEXT RECORD */       03730014
   END;                                                                 03740014
                                                                        03750014
   CALL RCBBUCM_END_COUNTRY;                                            03760014
 END;                                                                   03770014
0CALL RCBBUCM_TERM;                                                     03780014
1/********************************************************************/ 03790014
 /*                                                                  */ 03800014
 /* MODULE NAME      : INIT_PROGRAM                                  */ 03810014
 /*                                                                  */ 03820014
 /* DESCRIPTION      : INITIALISE PROGRAM                            */ 03830014
 /*                                                                  */ 03840014
 /********************************************************************/ 03850014
0RCBBUCM_INIT_PROGRAM: PROC;                                            03860014
                                     /* INITIALISE POINTERS          */ 03870014
 PTR_INT_AREA      = ADDR (PARM_INT_AREA);                              03880014
 PTR_RET_AREA_BB   = ADDR (PARM_RET_AREA_BB);                           03890014
 RCB475S_PTR       = ADDR (RCB475S);                                    03900014
 RCB475SI_PTR      = ADDR (RCB475SI);                                   03910014
 RCBV500_PTR       = ADDR (TB_RCBV500);                                 03920014
 RCBV500I_PTR      = ADDR (TB_RCBV500_I);                               03930014
                                     /* INITIALISE MESSAGE AREA      */ 03940014
 WRK_MOD_NAME                 = SDAISTP.SDAINAM;                        03950014
 WRK_PGM_NAME                 = SUBSTR(WRK_MOD_NAME,1,6) || 'P';        03960014
 PARM_INT_AREA.MSG_AREA       = '';                                     03970014
 PARM_INT_AREA.ERR_AREA       = '';                                     03980014
 PARM_INT_AREA.MSG_REQUEST    = 'O';                                    03990014
 PARM_INT_AREA.MSG_TARGET     = 'F';                                    04000014
 PARM_INT_AREA.ID_SOURCE_APPL = 'RCB';                                  04010014
 PARM_INT_AREA.ID_SOURCE_PROG = WRK_PGM_NAME;                           04020014
 PARM_INT_AREA.ID_MOD_PATH(1) = WRK_MOD_NAME;                           04030014
 PARM_INT_AREA.ID_MOD_LEVEL   = 1;                                      04040014
 PARM_INT_AREA.SYSTEM_TYPE    = WRK_SYSTEM_TYPE;                        04050014
 PARM_INT_AREA.PTR_PCB_IO     = NULL;                                   04060014
 PARM_INT_AREA.PTR_PCB_ALT    = NULL;                                   04070014
0PARM_INT_AREA.COUNTRY_NUMBER = '';                                     04080014
                                     /* OPEN MESSAGE FILE            */ 04090014
 CALL RCB0M1M(PTR_INT_AREA);                                            04100014
                                     /* RETRIEVE SYSTEM DATE         */ 04110014
 CALL RCB0T1M(PTR_INT_AREA);                                            04120014
                                     /* INITIALISE CHECKPOINT AREAS  */ 04130014
 CHKP_ID.NAME    = SUBSTR  (PARM_INT_AREA.ID_SOURCE_PROG,4,3);          04140014
 CHKP_LEN_AREA   = STORAGE (CHKP_AREA);                                 04150014
                                                                        04160014
 OPEN FILE (RCBPROC);                                                   04170014
 READ FILE (RCBPROC) INTO (RCBPROC_REC);  /* READ RCBPROC CARD */       04180014
                                                                        04190014
 IF SWITCH_EOF_RCBPROC                                                  04200014
 THEN                                                                   04210014
   DO;                                                                  04220014
     PARM_INT_AREA.MSG_VAR_CODES    = '';                               04230014
     PARM_INT_AREA.MESSAGE_TYPE     = 'IS';                             04240014
     PARM_INT_AREA.MESSAGE_NUMBER   = '0013';                           04250014
     PARM_INT_AREA.MSG_VAR_CODE_6   = 'FL';                             04260014
     PARM_INT_AREA.MSG_VAR_VALUE_6  = 'RCBPROC';                        04270014
     CALL RCB0M1M (PTR_INT_AREA);                                       04280014
     CALL RCBBUCM_ERROR (NULL(), 'OTHER', '#002');                      04290014
   END;                                                                 04300014
                                                                        04310014
 PARM_INT_AREA.PROC_ID = RCBPROC_REC.PROC_ID;            /* PTM 519 */  04320014
                                                                        04330014
 CLOSE FILE (RCBPROC);                                                  04340014
                                     /* INITIALISE OTHER FIELDS      */ 04350014
 END RCBBUCM_INIT_PROGRAM;                                              04360014
1/********************************************************************/ 04370014
 /*                                                                  */ 04380014
 /* MODULE NAME      : PRE_INIT                                      */ 04390014
 /*                                                                  */ 04400014
 /* DESCRIPTION      : INITIAL ACTIONS TO PRE-PROCESS THE FILE       */ 04410014
 /*                                                                  */ 04420014
 /********************************************************************/ 04430014
0RCBBUCM_PRE_INIT: PROC;                                                04440014
                                                                        04450014
0COUNT         = '';                                                    04460014
0SSK.EOF       = '0';                                                   04470014
0WRK_HASH_AREA = '';                                                    04480014
0WRK_DIM       = DIM (WRK_HASH_AREA.CTRYNO, 1);                         04490014
0WRK_IDX       = 0;                                                     04500014
                                                                        04510014
0OPEN FILE (RCBBUC0);                                                   04520014
0CALL RCBBUCM_PRE_READ_FILE;                       /* READ HEADER    */ 04530014
                                                                        04540014
0SELECT;                                                                04550014
   WHEN (SSK.EOF = '1')                                                 04560014
     DO;                                                                04570014
       CALL RCBBUCM_ISSUE_EMPTY_FILE;                                   04580014
       CALL RCBBUCM_ERROR(NULL,'OTHER','#003');                         04590014
     END;                                                               04600014
   WHEN (RCBBUC0_HEADER.REC_TYPE ¬= '01')                               04610014
     DO;                                                                04620014
       CALL RCBBUCM_ISSUE_NO_HEADER;                                    04630014
       CALL RCBBUCM_ERROR(NULL,'OTHER','#004');                         04640014
     END;                                                               04650014
   WHEN (RCBBUC0_HEADER.FILE_ID ¬= WRK_RCBBUC0)                         04660014
     DO;                                                                04670014
       CALL RCBBUCM_ISSUE_INV_HEADER;                                   04680014
       CALL RCBBUCM_ERROR(NULL,'OTHER','#005');                         04690014
     END;                                                               04700014
   OTHERWISE;                                                           04710014
 END;                                                                   04720014
                                                                        04730014
0WRK_TIME_STAMP = RCBBUC0_HEADER.TIMESTAMP;                             04740014
0WRK_SOURCE_IND = RCBBUC0_HEADER.SOURCE_INDICATOR;                      04750014
0CALL RCBBUCM_PRE_READ_FILE;                       /* READ DATA      */ 04760014
                                                                        04770014
0END RCBBUCM_PRE_INIT;                                                  04780014
1/********************************************************************/ 04790014
 /*                                                                  */ 04800014
 /* MODULE NAME      : PRE_INIT_COUNTRY                              */ 04810014
 /*                                                                  */ 04820014
 /* DESCRIPTION      : INITIAL ACTIONS FOR A COUNTRY DURING          */ 04830014
 /*                    PRE-PROCESSING THE ACTION FILE                */ 04840014
 /*                                                                  */ 04850014
 /********************************************************************/ 04860014
0RCBBUCM_PRE_INIT_COUNTRY: PROC;                                        04870014
0PARM_INT_AREA.COUNTRY_NUMBER = SSK.CTRYNO;                             04880014
0CNT_HASH_TOTAL               = 0 ;                                     04890014
0PREV_SSK                     = SSK;                                    04900014
0WRK_IDX                      = WRK_IDX + 1;                            04910014
0IF WRK_IDX <= WRK_DIM                                                  04920014
 THEN                                                                   04930014
   DO;                                                                  04940014
     WRK_HASH_AREA.COUNT_CTRY       = WRK_HASH_AREA.COUNT_CTRY + 1;     04950014
     WRK_HASH_AREA.CTRYNO (WRK_IDX) = RCBBUC0_RECORD.CTRYNO;            04960014
   END;                                                                 04970014
 ELSE                                                                   04980014
   DO;                                                                  04990014
     CALL RCBBUCM_ERROR (NULL(),                    /* ABEND         */ 05000014
                        'OTHER',                                        05010014
                        '#006');                                        05020014
   END;                                                                 05030014
0END RCBBUCM_PRE_INIT_COUNTRY;                                          05040014
1/********************************************************************/ 05050014
 /*                                                                  */ 05060014
 /* MODULE NAME      : PRE_READ_FILE                                 */ 05070014
 /*                                                                  */ 05080014
 /* DESCRIPTION      : READ FILE DURING PRE-PROCESSING               */ 05090014
 /*                                                                  */ 05100014
 /********************************************************************/ 05110014
0RCBBUCM_PRE_READ_FILE: PROC;                                           05120014
0READ FILE (RCBBUC0) INTO (RCBBUC0_IOAREA);                             05130014
0IF SSK.EOF = '0'                                                       05140014
 THEN                                                                   05150014
   DO;                                                                  05160014
     PREV_SSK     = SSK;                                                05170014
     SSK.REC_TYPE = RCBBUC0_RECORD.REC_TYPE;                            05180014
     SELECT (RCBBUC0_RECORD.REC_TYPE);                                  05190014
       WHEN ('01');                                                     05200014
       WHEN ('02')                                                      05210014
         DO;                                                            05220014
           SSK.CTRYNO             = RCBBUC0_RECORD.CTRYNO;              05230014
           SSK.COUNTRY_NUMBER     = RCBBUC0_RECORD.COUNTRY_NUMBER;      05240014
           SSK.SERVICE_LVL_CODE   = RCBBUC0_RECORD.SERVICE_LVL_CODE;    05250014
           COUNT.CNT_TOT.ACTIONS  = COUNT.CNT_TOT.ACTIONS + 1;          05260014
         END;                                                           05270014
       WHEN ('99');                                                     05280014
       OTHERWISE                                                        05290014
         DO;                                                            05300014
           CALL RCBBUCM_ISSUE_INV_REC_TYPE;                             05310014
           CALL RCBBUCM_ERROR (NULL(),               /* ABEND       */  05320014
                              'OTHER',                                  05330014
                              '#007');                                  05340014
         END;                                                           05350014
     END;                                                               05360014
     PARM_INT_AREA.SEQUENCE_KEY = STRING(SSK);        /* RC01141 */     05370014
   END;                                                                 05380014
0END RCBBUCM_PRE_READ_FILE;                                             05390014
1/********************************************************************/ 05400014
 /*                                                                  */ 05410014
 /* MODULE NAME      : PRE_PROCESS                                   */ 05420014
 /*                                                                  */ 05430014
 /* DESCRIPTION      : PROCESS THE FILE DATA RECORD DURING PRE-PROC. */ 05440014
 /*                    COUNT HASH TOTAL                              */ 05450014
 /*                                                                  */ 05460014
 /********************************************************************/ 05470014
0RCBBUCM_PRE_PROCESS: PROC;                                             05480014
0WRK_HASH_FIELD =                                                       05490014
     SUBSTR (RCBBUC0_RECORD.RCB475S.SERVICE_LVL_CODE, 1, 3);            05500014
0CALL RCB018M (WRK_HASH_FIELD,                                          05510014
               CNT_HASH_TOTAL,                                          05520014
               PTR_INT_AREA);                                           05530014
0END RCBBUCM_PRE_PROCESS;                                               05540014
1/********************************************************************/ 05550014
 /*                                                                  */ 05560014
 /* MODULE NAME      : PRE_END_COUNTRY                               */ 05570014
 /*                                                                  */ 05580014
 /* DESCRIPTION      : ENDING ACTION FOR A COUNTRY DURING            */ 05590014
 /*                    PRE-PROCESSING. STORE CALCULATED HASH TOTAL   */ 05600014
 /*                    IN THE WRK_HASH_AREA.                         */ 05610014
 /*                                                                  */ 05620014
 /********************************************************************/ 05630014
0RCBBUCM_PRE_END_COUNTRY: PROC;                                         05640014
0WRK_HASH_AREA.HASH_TOTAL (WRK_IDX) = CNT_HASH_TOTAL;                   05650014
 WRK_HASH_AREA.TIME_STAMP (WRK_IDX) = WRK_TIME_STAMP;                   05660014
0END RCBBUCM_PRE_END_COUNTRY;                                           05670014
1/********************************************************************/ 05680014
 /*                                                                  */ 05690014
 /* MODULE NAME      : PRE_END                                       */ 05700014
 /*                                                                  */ 05710014
 /* DESCRIPTION      : ENDING ACTIONS FOR PRE-PROCESSING             */ 05720014
 /*                                                                  */ 05730014
 /********************************************************************/ 05740014
0RCBBUCM_PRE_END: PROC;                                                 05750014
0IF SSK.EOF = '1'                                                       05760014
 THEN                                                                   05770014
   DO;                                                                  05780014
     CALL RCBBUCM_ISSUE_NO_TRAILER;                                     05790014
     CALL RCBBUCM_ERROR (NULL(),                   /* ABEND          */ 05800014
                         'OTHER',                                       05810014
                         '#008');                                       05820014
   END;                                                                 05830014
                                     /* CHECK RECORD COUNT TRAILER   */ 05840014
0IF RCBBUC0_TRAILER.CNT_RECS ¬= COUNT.CNT_TOT.ACTIONS                   05850014
 THEN                                                                   05860014
   DO;                                                                  05870014
     CALL RCBBUCM_ISSUE_INV_COUNT;                                      05880014
     CALL RCBBUCM_ERROR (NULL(),                   /* ABEND          */ 05890014
                         'OTHER',                                       05900014
                         '#009');                                       05910014
   END;                                                                 05920014
                                     /* CHECK RECORDS AFTER TRAILER  */ 05930014
0CALL RCBBUCM_PRE_READ_FILE;                                            05940014
0IF SSK.EOF ¬= '1'                                                      05950014
 THEN                                                                   05960014
   DO;                                                                  05970014
     CALL RCBBUCM_ISSUE_REC_AFTER;                                      05980014
     CALL RCBBUCM_ERROR (NULL(),                   /* ABEND          */ 05990014
                         'OTHER',                                       06000014
                         '#010');                                       06010014
   END;                                                                 06020014
                                                                        06030014
 CLOSE FILE (RCBBUC0);                                                  06040014
                                                                        06050014
0SSK       = '';                     /* RESET VARIABLES              */ 06060014
0PREV_SSK  = '';                                                        06070014
0SSK.EOF   = '0';                                                       06080014
0COUNT     = '';                                                        06090014
                                                                        06100014
0END RCBBUCM_PRE_END;                                                   06110014
1/********************************************************************/ 06120014
 /*                                                                  */ 06130014
 /* MODULE NAME      : CHECK_HASH                                    */ 06140014
 /*                                                                  */ 06150014
 /* DESCRIPTION      : CHECK THE CALCULATED HASH TOTALS AND THE      */ 06160014
 /*                    HEADER TIME STAMP AGAINST THE RCB024          */ 06170014
 /*                    PARAMETERS FOR EACH COUNTRY NUMBER.           */ 06180014
 /*                                                                  */ 06190014
 /********************************************************************/ 06200014
0RCBBUCM_CHECK_HASH: PROC;                                              06210014
                                                                        06220014
 DO WRK_IDX = 1 TO WRK_HASH_AREA.COUNT_CTRY;                            06230014
   CALL RCBBUCM_RETRIEVE_RCBP24S (WRK_HASH_AREA.CTRYNO (WRK_IDX));      06240014
                                                                        06250014
   IF WRK_HASH_AREA.TIME_STAMP (WRK_IDX) ¬= RCBP24S.TIME_STAMP          06260014
   THEN                                                                 06270014
     DO;                                                                06280014
      PARM_INT_AREA.COUNTRY_NUMBER  = WRK_HASH_AREA.CTRYNO (WRK_IDX);   06290014
      PARM_INT_AREA.MSG_VAR_CODES   = '';                               06300014
      PARM_INT_AREA.MESSAGE_TYPE    = 'IS';                             06310014
      PARM_INT_AREA.MESSAGE_NUMBER  = '0174';                           06320014
      PARM_INT_AREA.MSG_VAR_CODE_6  = 'FL';                             06330014
      PARM_INT_AREA.MSG_VAR_VALUE_6 = WRK_RCBBUC0;                      06340014
      PARM_INT_AREA.MSG_VAR_CODE_7  = 'TP';                             06350014
      PARM_INT_AREA.MSG_VAR_VALUE_7 =                                   06360014
                                    WRK_HASH_AREA.TIME_STAMP (WRK_IDX); 06370014
      PARM_INT_AREA.MSG_VAR_CODE_8  = 'TP';                             06380014
      PARM_INT_AREA.MSG_VAR_VALUE_8 = RCBP24S.TIME_STAMP;               06390014
      CALL RCB0M1M (ADDR(PARM_INT_AREA));                               06400014
      CALL RCBBUCM_ERROR (NULL(),                    /* ABEND         */06410014
                          'OTHER',                                      06420014
                          '#011');                                      06430014
     END;                                                               06440014
                                                                        06450014
   IF WRK_HASH_AREA.HASH_TOTAL (WRK_IDX) ¬= RCBP24S.HASH_TOTAL          06460014
   THEN                                                                 06470014
     DO;                                                                06480014
       PARM_INT_AREA.COUNTRY_NUMBER  = WRK_HASH_AREA.CTRYNO (WRK_IDX);  06490014
       PARM_INT_AREA.MESSAGE_TYPE    = 'IS';                            06500014
       PARM_INT_AREA.MESSAGE_NUMBER  = '0175';                          06510014
       PARM_INT_AREA.MSG_VAR_CODES   = '';                              06520014
       PARM_INT_AREA.MSG_VAR_CODE_6  = 'FL';                            06530014
       PARM_INT_AREA.MSG_VAR_VALUE_6 = WRK_RCBBUC0;                     06540014
       PARM_INT_AREA.MSG_VAR_CODE_7  = 'HT';                            06550014
       CNT_PIC15                     =                                  06560014
                                     WRK_HASH_AREA.HASH_TOTAL (WRK_IDX);06570014
       PARM_INT_AREA.MSG_VAR_VALUE_7 = CNT_PIC15;                       06580014
       PARM_INT_AREA.MSG_VAR_CODE_8  = 'HT';                            06590014
       CNT_PIC15                     = RCBP24S.HASH_TOTAL;              06600014
       PARM_INT_AREA.MSG_VAR_VALUE_8 = CNT_PIC15;                       06610014
       CALL RCB0M1M(PTR_INT_AREA);                                      06620014
       CALL RCBBUCM_ERROR (NULL(),                                      06630014
                           'OTHER',                                     06640014
                           '#012');                                     06650014
     END;                                                               06660014
 END;                                                                   06670014
0END RCBBUCM_CHECK_HASH;                                                06680014
1/********************************************************************/ 06690014
 /*                                                                  */ 06700014
 /* MODULE NAME      : INIT_COUNTRY                                  */ 06710014
 /*                                                                  */ 06720014
 /* DESCRIPTION      : INITIALISE FOR A NEW COUNTRY                  */ 06730014
 /*                                                                  */ 06740014
 /********************************************************************/ 06750014
0RCBBUCM_INIT_COUNTRY: PROC;                                            06760014
0PARM_INT_AREA.COUNTRY_NUMBER  = SSK.CTRYNO;                            06770014
0COUNT.CNT_CTRY                = 0;                /* RESET COUNTERS */ 06780014
 PREV_SSK                      = SSK;                                   06790014
                                                                        06800014
0CALL RCBBUCM_LOCK_TABLE;                                 /* RC01219 */ 06810014
 CALL RCBBUCM_RETRIEVE_RCBP12S;         /* CHECKPOINT LIMIT          */ 06820014
                                                                        06830014
                                                                        06840014
 END RCBBUCM_INIT_COUNTRY;                                              06850014
1/********************************************************************/ 06860014
 /*                                                                  */ 06870014
 /* MODULE NAME      : INIT_ACTION                                   */ 06880014
 /*                                                                  */ 06890014
 /* DESCRIPTION      : INITIALISE FOR AN ACTION RECORD               */ 06900014
 /*                                                                  */ 06910014
 /********************************************************************/ 06920014
0RCBBUCM_INIT_ACTION: PROC;                                             06930014
0PARM_RET_AREA_BB       = '';                                           06940014
 WRK_CURR_DATE          = RCBBUC0_RECORD.RUN_DATE;                      06950014
 PARM_INT_AREA.RUN_DATE = WRK_CURR_DATE;                                06960014
 END RCBBUCM_INIT_ACTION;                                               06970014
1/********************************************************************/ 06980014
 /*                                                                  */ 06990014
 /* MODULE NAME      : RCBBUCM_LOCK_TABLE                            */ 07000014
 /*                                                                  */ 07010014
 /* DESCRIPTION      : LOCK EXCLUSIVE TABLE RCBV0475_CTRY_COND       */ 07020014
 /*                                                                  */ 07030014
 /********************************************************************/ 07040014
0RCBBUCM_LOCK_TABLE: PROC;                                              07050014
                                                      /* SOC RC01219 */ 07060014
0PARM_RCB024M.COUNTRY_NUMBER = PARM_INT_AREA.COUNTRY_NUMBER;            07070014
 PARM_RCB024M.LOCK_MODE      = 'E';                /* EXCLUSIVE MODE */ 07080014
 PARM_RCB024M.VIEW_NAME      = 'RCBT0475_CTRY_COND';                    07090014
                                                                        07100014
                                   /* LOCK DB2 TABLE PARTITIONS      */ 07110014
 CALL RCB024M (ADDR(PARM_RCB024M),                                      07120014
               PTR_RET_AREA_BB,                                         07130014
               PTR_INT_AREA);                                           07140014
                                                                        07150014
 SELECT(PARM_RET_AREA_BB.RETURN_CODE);                                  07160014
   WHEN (0);                                                            07170014
   WHEN (4)                        /* INVALID OR AMBIGUOUS PARAMETER */ 07180014
     DO;                                                                07190014
       CALL RCBBUCM_ERROR (NULL, 'OTHER', '#013');                      07200014
     END;                                                               07210014
   OTHERWISE                                                            07220014
     DO;                                                                07230014
       CALL RCBBUCM_ERROR (ADDR (PARM_RET_AREA_BB.RETURN_SQL),          07240014
                                 'DB2',                                 07250014
                                 '#047');                               07260014
     END;                                                               07270014
 END;                                                 /* EOC RC01219 */ 07280014
 END RCBBUCM_LOCK_TABLE;                                                07290014
1/********************************************************************/ 07300014
 /*                                                                  */ 07310014
 /* MODULE NAME      : RCBBUCM_OPEN_FILE_RCBBUC0                     */ 07320014
 /*                                                                  */ 07330014
 /* DESCRIPTION      : OPEN GSAM FILE                                */ 07340014
 /*                                                                  */ 07350014
 /********************************************************************/ 07360014
0RCBBUCM_OPEN_FILE_RCBBUC0: PROC;                                       07370014
0CALL PLITDLI(TWO,                                                      07380014
              OPEN,                                                     07390014
              PTR_RCBBUC0);                                             07400014
 SELECT (PCB_RCBBUC0.ST_CODE);                                          07410014
 WHEN ('')                                                              07420014
   DO;                                                                  07430014
     SSK.EOF = '0';                                                     07440014
   END;                                                                 07450014
 OTHERWISE                                                              07460014
   DO;                                                                  07470014
     CALL RCBBUCM_ERROR (ADDR (PCB_RCBBUC0),                            07480014
                         'IMS_DB',                                      07490014
                         '#014');                                       07500014
   END;                                                                 07510014
 END;                                                                   07520014
 END RCBBUCM_OPEN_FILE_RCBBUC0;                                         07530014
1/********************************************************************/ 07540014
 /*                                                                  */ 07550014
 /* MODULE NAME      : RCBBUCM_READ_FILE_RCBBUC0                     */ 07560014
 /*                                                                  */ 07570014
 /* DESCRIPTION      : READ RECORD FROM GSAM FILE                    */ 07580014
 /*                                                                  */ 07590014
 /********************************************************************/ 07600014
0RCBBUCM_READ_FILE_RCBBUC0: PROC;                                       07610014
0CALL PLITDLI (THREE,                                                   07620014
               GN,                                                      07630014
               PTR_RCBBUC0,                                             07640014
               RCBBUC0_IOAREA);                                         07650014
0SELECT (PCB_RCBBUC0.ST_CODE);                                          07660014
 WHEN ('')                                                              07670014
   DO;                                                                  07680014
     PREV_SSK        = SSK;                                             07690014
     CHKP_CNT_STEPS  = CHKP_CNT_STEPS + 1;                              07700014
     SSK.REC_TYPE    = RCBBUC0_RECORD.REC_TYPE;                         07710014
0    SELECT (RCBBUC0_RECORD.REC_TYPE);                                  07720014
     WHEN ('01');                                                       07730014
     WHEN ('02')                                                        07740014
       DO;                                                              07750014
         SSK.CTRYNO               = RCBBUC0_RECORD.CTRYNO;              07760014
         SSK.COUNTRY_NUMBER     = RCBBUC0_RECORD.COUNTRY_NUMBER;        07770014
         SSK.SERVICE_LVL_CODE   = RCBBUC0_RECORD.SERVICE_LVL_CODE;      07780014
       END;                                                             07790014
     WHEN ('99');                                                       07800014
     OTHERWISE                                                          07810014
       DO;                                                              07820014
         CALL RCBBUCM_ISSUE_INV_REC_TYPE;                               07830014
         CALL RCBBUCM_ERROR (NULL(),               /* ABEND          */ 07840014
                            'OTHER',                                    07850014
                            '#016');                                    07860014
       END;                                                             07870014
     END;                                                               07880014
     PARM_INT_AREA.SEQUENCE_KEY = STRING(SSK);        /* RC01141 */     07890014
   END;                                                                 07900014
0WHEN ('GB')                                                            07910014
   DO;                                                                  07920014
     SSK.EOF = '1';                                                     07930014
   END;                                                                 07940014
0OTHERWISE                                                              07950014
   DO;                                                                  07960014
     CALL RCBBUCM_ERROR (PTR_RCBBUC0,                                   07970014
                        'IMS_DB',                                       07980014
                        '#017');                                        07990014
   END;                                                                 08000014
 END;                                                                   08010014
                                                                        08020014
 END RCBBUCM_READ_FILE_RCBBUC0;                                         08030014
1/********************************************************************/ 08040014
 /*                                                                  */ 08050014
 /* MODULE NAME      : RCBBUCM_CLOSE_FILE_RCBBUC0                    */ 08060014
 /*                                                                  */ 08070014
 /* DESCRIPTION      : CLOSE GSAM FILE                               */ 08080014
 /*                                                                  */ 08090014
 /********************************************************************/ 08100014
0RCBBUCM_CLOSE_FILE_RCBBUC0: PROC;                                      08110014
0CALL PLITDLI(TWO,                                                      08120014
              CLSE,                                                     08130014
              PTR_RCBBUC0);                                             08140014
 SELECT (PCB_RCBBUC0.ST_CODE);                                          08150014
 WHEN ('');                                                             08160014
 OTHERWISE                                                              08170014
   DO;                                                                  08180014
     CALL RCBBUCM_ERROR (ADDR (PCB_RCBBUC0),                            08190014
                         'IMS_DB',                                      08200014
                         '#019');                                       08210014
   END;                                                                 08220014
 END;                                                                   08230014
 END RCBBUCM_CLOSE_FILE_RCBBUC0;                                        08240014
1/********************************************************************/ 08250014
 /*                                                                  */ 08260014
 /* MODULE NAME      : RCBBUCM_RETRIEVE_RCBP12S                      */ 08270014
 /*                                                                  */ 08280014
 /* DESCRIPTION      : RETRIEVE THE RCB012 PARAMETER                 */ 08290014
 /*                                                                  */ 08300014
 /********************************************************************/ 08310014
0RCBBUCM_RETRIEVE_RCBP12S:  PROC;                                       08320014
0PARM_RET_AREA_BB     = '';                                             08330014
 TB_RCBV500           = '';                                             08340014
 TB_RCBV500_I         = '';                                             08350014
 TB_RCBP12S.NUMBER    = 'RCB012';                                       08360014
 TB_RCBP12S.PGR_TYPE  = RCBBUC0_RECORD.PGR_TYPE;                        08370014
 TB_RCBP12S.PGM_NAME  = WRK_PGM_NAME;                                   08380014
 TB_RCBP12S.CTRYNO    = RCBBUC0_RECORD.CTRYNO;                          08390014
0CALL RCBI50M ('U',                                       /* RC01219 */ 08400014
               RCBV500_PTR,                                             08410014
               RCBV500I_PTR,                                            08420014
               PTR_RET_AREA_BB,                                         08430014
               PTR_INT_AREA);                                           08440014
 SELECT(PARM_RET_AREA_BB.RETURN_CODE);                                  08450014
 WHEN (0)                                                               08460014
   DO;                                                                  08470014
     RCBP12S = TB_RCBP12S;                                              08480014
   END;                                                                 08490014
 WHEN (4)                                                               08500014
   DO;                                                                  08510014
     RCBP12S.CHKP_LIMIT = 0;                                            08520014
     CALL RCBBUCM_ISSUE_CHKP_LIMIT;                                     08530014
   END;                                                                 08540014
 OTHERWISE                                                              08550014
   DO;                                                                  08560014
     CALL RCBBUCM_ERROR (ADDR (PARM_RET_AREA_BB.RETURN_SQL),            08570014
                         'DB2',                                         08580014
                         '#021');                                       08590014
   END;                                                                 08600014
 END;                                                                   08610014
 END RCBBUCM_RETRIEVE_RCBP12S;                                          08620014
1/********************************************************************/ 08630014
 /*                                                                  */ 08640014
 /* MODULE NAME      : RETRIEVE_RCBP24S                              */ 08650014
 /*                                                                  */ 08660014
 /* DESCRIPTION      : RETRIEVE PARAMETER RCB024 FOR A SPECIFIC      */ 08670014
 /*                    COUNTRY NUMBER.                               */ 08680014
 /*                                                                  */ 08690014
 /********************************************************************/ 08700014
0RCBBUCM_RETRIEVE_RCBP24S: PROC (PARM_CTRYNO);                          08710014
                                                                        08720014
 DCL PARM_CTRYNO  CHAR (03);                                            08730014
                                                                        08740014
 TB_RCBV500                   = '';                                     08750014
 TB_RCBV500_I                 = '';                                     08760014
 TB_RCBP24S.NUMBER            = 'RCB024';                               08770014
 TB_RCBP24S.PROC_ID           = RCBPROC_REC.PROC_ID;                    08780014
 TB_RCBP24S.CTRYNO            = PARM_CTRYNO;                            08790014
 TB_RCBP24S.FILE_NAME         = WRK_RCBBUC0;                            08800014
 TB_RCBP24S.SEQ_NUMBER        = '01';                                   08810014
                                                                        08820014
0CALL RCBI50M ('U',                                       /* RC01219 */ 08830014
               ADDR(TB_RCBV500),                                        08840014
               ADDR(TB_RCBV500_I),                                      08850014
               PTR_RET_AREA_BB,                                         08860014
               PTR_INT_AREA);                                           08870014
0SELECT(PARM_RET_AREA_BB.RETURN_CODE);                                  08880014
 WHEN (0)                                                               08890014
   DO;                                                                  08900014
     RCBP24S = TB_RCBP24S, BY NAME;                                     08910014
   END;                                                                 08920014
 WHEN (4)                                                               08930014
   DO;                                                                  08940014
      PARM_INT_AREA.MESSAGE_TYPE      = 'IS';                           08950014
      PARM_INT_AREA.MESSAGE_NUMBER    = 'I050';                         08960014
      PARM_INT_AREA.MSG_VAR_CODES     = '';                             08970014
      PARM_INT_AREA.MSG_VAR_CODE_6    = 'PN';                           08980014
      PARM_INT_AREA.MSG_VAR_VALUE_6   = 'RCB024';                       08990014
      PARM_INT_AREA.MSG_VAR_CODE_7    = 'PK';                           09000014
      PARM_INT_AREA.MSG_VAR_VALUE_7   =  STRING (TB_RCBP24S.EXTRA_KEY); 09010014
      CALL RCB0M1M (PTR_INT_AREA);                                      09020014
      CALL RCBBUCM_ERROR (NULL,                                         09030014
                         'OTHER',                                       09040014
                         '#026');                                       09050014
   END;                                                                 09060014
 OTHERWISE                                                              09070014
   DO;                                                                  09080014
     CALL RCBBUCM_ERROR (ADDR (PARM_RET_AREA_BB.RETURN_SQL),            09090014
                         'DB2',                                         09100014
                         '#027');                                       09110014
   END;                                                                 09120014
 END;                                                                   09130014
                                                                        09140014
0END RCBBUCM_RETRIEVE_RCBP24S;                                          09150014
1/********************************************************************/ 09160014
 /*                                                                  */ 09170014
 /* MODULE NAME      : INSERT                                        */ 09180014
 /*                                                                  */ 09190014
 /* DESCRIPTION      : INSERT ROW INTO RCBV0475_CTRY_COND USING      */ 09200014
 /*                    RCBF85M                                       */ 09210014
 /*                                                                  */ 09220014
 /********************************************************************/ 09230014
0RCBBUCM_INSERT: PROC;                                                  09240014
                                     /* COPY INPUT RECORD INFO       */ 09250014
 RCB475SI = RCBBUC0_RECORD.RCB475SI, BY NAME;                           09260014
 RCB475S  = RCBBUC0_RECORD.RCB475S, BY NAME;                            09270014
                                     /* INSERT INTO TABLE            */ 09280014
 CALL RCBF85M (RCB475S_PTR,                                             09290014
               RCB475SI_PTR,                                            09300014
               PTR_RET_AREA_BB,                                         09310014
               PTR_INT_AREA);                                           09320014
 SELECT (PARM_RET_AREA_BB.RETURN_CODE);                                 09330014
 WHEN (0)                                                               09340014
   DO;                                                                  09350014
     COUNT.CNT_CTRY.INSERTS = COUNT.CNT_CTRY.INSERTS + 1;               09360014
   END;                                                                 09370014
                                     /* TRY TO UPDATE                */ 09380014
 WHEN (4)                                                               09390014
   DO;                                                                  09400014
     CALL RCBBUCM_UPDATE;                                               09410014
   END;                                                                 09420014
 OTHERWISE                                                              09430014
   DO;                                                                  09440014
     CALL RCBBUCM_ERROR(ADDR(PARM_RET_AREA_BB.RETURN_SQL),              09450014
                        'DB2','#029');                                  09460014
   END;                                                                 09470014
 END;                                                                   09480014
 CHKP_CNT_STEPS = CHKP_CNT_STEPS + 1;                                   09490014
 END RCBBUCM_INSERT;                                                    09500014
1/********************************************************************/ 09510014
 /*                                                                  */ 09520014
 /* MODULE NAME      : UPDATE                                        */ 09530014
 /*                                                                  */ 09540014
 /* DESCRIPTION      : UPDATE ROW OF RCBV0475_CTRY_COND USING        */ 09550014
 /*                    RCBG85M                                       */ 09560014
 /*                                                                  */ 09570014
 /********************************************************************/ 09580014
0RCBBUCM_UPDATE: PROC;                                                  09590014
                                     /* COPY INPUT RECORD INFO       */ 09600014
 RCB475SI = RCBBUC0_RECORD.RCB475SI, BY NAME;                           09610014
 RCB475S  = RCBBUC0_RECORD.RCB475S, BY NAME;                            09620014
                                     /* UPDATE OF TABLE              */ 09630014
 CALL RCBG85M (RCB475S_PTR,                                             09640014
               RCB475SI_PTR,                                            09650014
               PTR_RET_AREA_BB,                                         09660014
               PTR_INT_AREA);                                           09670014
 SELECT (PARM_RET_AREA_BB.RETURN_CODE);                                 09680014
 WHEN (0)                                                               09690014
   DO;                                                                  09700014
     COUNT.CNT_CTRY.UPDATES = COUNT.CNT_CTRY.UPDATES + 1;               09710014
   END;                                                                 09720014
 OTHERWISE                                                              09730014
   DO;                                                                  09740014
     CALL RCBBUCM_ERROR(ADDR(PARM_RET_AREA_BB.RETURN_SQL),              09750014
                        'DB2','#032');                                  09760014
   END;                                                                 09770014
 END;                                                                   09780014
 CHKP_CNT_STEPS = CHKP_CNT_STEPS + 1;                                   09790014
 END RCBBUCM_UPDATE;                                                    09800014
1/********************************************************************/ 09810014
 /*                                                                  */ 09820014
 /* MODULE NAME      : DELETE                                        */ 09830014
 /*                                                                  */ 09840014
 /* DESCRIPTION      : CLOSE ROW OF RCBV0475_CTRY_COND USING         */ 09850014
 /*                    RCBH85M                                       */ 09860014
 /*                                                                  */ 09870014
 /********************************************************************/ 09880014
0RCBBUCM_DELETE: PROC;                                                  09890014
                                     /* COPY INPUT RECORD INFO       */ 09900014
 RCB475SI = RCBBUC0_RECORD.RCB475SI, BY NAME;                           09910014
 RCB475S  = RCBBUC0_RECORD.RCB475S, BY NAME;                            09920014
                                     /* DELETE OF TABLE ROW          */ 09930014
 CALL RCBH85M (RCB475S_PTR,                                             09940014
               RCB475SI_PTR,                                            09950014
               PTR_RET_AREA_BB,                                         09960014
               PTR_INT_AREA);                                           09970014
 SELECT (PARM_RET_AREA_BB.RETURN_CODE);                                 09980014
 WHEN (0,4)                                                             09990014
   DO;                                                                  10000014
     COUNT.CNT_CTRY.DELETES = COUNT.CNT_CTRY.DELETES + 1;               10010014
   END;                                                                 10020014
 OTHERWISE                                                              10030014
   DO;                                                                  10040014
     CALL RCBBUCM_ERROR(ADDR(PARM_RET_AREA_BB.RETURN_SQL),              10050014
                        'DB2','#033');                                  10060014
   END;                                                                 10070014
 END;                                                                   10080014
 CHKP_CNT_STEPS = CHKP_CNT_STEPS + 1;                                   10090014
 END RCBBUCM_DELETE;                                                    10100014
1/********************************************************************/ 10110014
 /*                                                                  */ 10120014
 /* MODULE NAME      : END_COUNTRY                                   */ 10130014
 /*                                                                  */ 10140014
 /* DESCRIPTION      : ENDING ACTIONS FOR A COUNTRY                  */ 10150014
 /*                                                                  */ 10160014
 /********************************************************************/ 10170014
0RCBBUCM_END_COUNTRY: PROC;                                             10180014
                                                                        10190014
 COUNT.CNT_TOT.ACTIONS = COUNT.CNT_TOT.ACTIONS + COUNT.CNT_CTRY.ACTIONS;10200014
 COUNT.CNT_TOT.UPDATES = COUNT.CNT_TOT.UPDATES + COUNT.CNT_CTRY.UPDATES;10210014
 COUNT.CNT_TOT.DELETES = COUNT.CNT_TOT.DELETES + COUNT.CNT_CTRY.DELETES;10220014
 COUNT.CNT_TOT.INSERTS = COUNT.CNT_TOT.INSERTS + COUNT.CNT_CTRY.INSERTS;10230014
 COUNT.CNT_TOT.SKIPPED = COUNT.CNT_TOT.SKIPPED + COUNT.CNT_CTRY.SKIPPED;10240014
                                                                        10250014
 CALL RCBBUCM_ISSUE_CNT (COUNT.CNT_CTRY);    /* ISSUE COUNT MESSAGES */ 10260014
                                                                        10270014
 CALL RCBBUCM_CHKP_ISSUE;                    /* TAKE CHECK POINT     */ 10280014
                                                                        10290014
0END RCBBUCM_END_COUNTRY;                                               10300014
1/********************************************************************/ 10310014
 /*                                                                  */ 10320014
 /* MODULE NAME      : TERM                                          */ 10330014
 /*                                                                  */ 10340014
 /* DESCRIPTION      : TERMINATING ACTIONS FOR THE PROGRAM           */ 10350014
 /*                                                                  */ 10360014
 /********************************************************************/ 10370014
0RCBBUCM_TERM: PROC;                                                    10380014
0PARM_INT_AREA.COUNTRY_NUMBER = '';                                     10390014
                                     /* ISSUE COUNT MESSAGES         */ 10400014
 CALL RCBBUCM_ISSUE_CNT (COUNT.CNT_TOT);                                10410014
                                     /* ISSUE ENDED SUCCESFULLY MSG  */ 10420014
 CALL RCBBUCM_ISSUE_SUCCESS;                                            10430014
                                     /* CLOSE INPUT FILE             */ 10440014
 CALL RCBBUCM_CLOSE_FILE_RCBBUC0;                                       10450014
                                     /* CLOSE MESSAGE FILE           */ 10460014
 PARM_INT_AREA.MSG_REQUEST    = 'C';                                    10470014
 CALL RCB0M1M(PTR_INT_AREA);                                            10480014
 END RCBBUCM_TERM;                                                      10490014
1/********************************************************************/ 10500014
 /*                                                                  */ 10510014
 /* MODULE NAME      : RCBBUCM_ISSUE_CNT                             */ 10520014
 /*                                                                  */ 10530014
 /* DESCRIPTION      : ISSUE MESSAGE COUNTS                          */ 10540014
 /*                                                                  */ 10550014
 /********************************************************************/ 10560014
0RCBBUCM_ISSUE_CNT: PROC (PARM_COUNT);                                  10570014
                                                                        10580014
 DCL 1 PARM_COUNT,                                                      10590014
 /*    3 ACTIONS       FIXED BIN(31),                 /* SOC RB01299 */ 10600014
 /*    3 UPDATES       FIXED BIN(31),                                */ 10610014
 /*    3 DELETES       FIXED BIN(31),                                */ 10620014
 /*    3 INSERTS       FIXED BIN(31),                                */ 10630014
 /*    3 SKIPPED       FIXED BIN(31);                                */ 10640014
       3 ACTIONS       FIXED DEC(15,0),                                 10650014
       3 UPDATES       FIXED DEC(15,0),                                 10660014
       3 DELETES       FIXED DEC(15,0),                                 10670014
       3 INSERTS       FIXED DEC(15,0),                                 10680014
       3 SKIPPED       FIXED DEC(15,0);               /* EOC RB01299 */ 10690014
                                                                        10700014
 PARM_INT_AREA.MESSAGE_TYPE     = 'IS';                                 10710014
 PARM_INT_AREA.MESSAGE_NUMBER   = '0003';                               10720014
 PARM_INT_AREA.MSG_VAR_CODES    = '';                                   10730014
 PARM_INT_AREA.MSG_VAR_CODE_6   = 'FL';                                 10740014
 PARM_INT_AREA.MSG_VAR_VALUE_6  = WRK_RCBBUC0;                          10750014
 PARM_INT_AREA.MSG_VAR_CODE_7   = 'C1';                                 10760014
 /* CNT_PIC9                       = PARM_COUNT.ACTIONS;/*SOC RB01299*/ 10770014
 /* PARM_INT_AREA.MSG_VAR_VALUE_7  = CNT_PIC9;                       */ 10780014
 CNT_PIC15                      = PARM_COUNT.ACTIONS;                   10790014
 PARM_INT_AREA.MSG_VAR_VALUE_7  = CNT_PIC15;          /* EOC RB01299 */ 10800014
 PARM_INT_AREA.MSG_VAR_CODE_11  = 'C5';                                 10810014
 /* CNT_PIC9                       = PARM_COUNT.SKIPPED;/*SOC RB01299*/ 10820014
 /* PARM_INT_AREA.MSG_VAR_VALUE_11 = CNT_PIC9;                       */ 10830014
 CNT_PIC15                      = PARM_COUNT.SKIPPED;                   10840014
 PARM_INT_AREA.MSG_VAR_VALUE_11 = CNT_PIC15;          /* EOC RB01299 */ 10850014
 CALL RCB0M1M(PTR_INT_AREA);                                            10860014
                                                                        10870014
0PARM_INT_AREA.MESSAGE_TYPE     = 'IS';                                 10880014
 PARM_INT_AREA.MESSAGE_NUMBER   = '0148';                               10890014
 PARM_INT_AREA.MSG_VAR_CODES    = '';                                   10900014
 PARM_INT_AREA.MSG_VAR_CODE_6   = 'IN';                                 10910014
 /* CNT_PIC9                       = PARM_COUNT.INSERTS;/*SOC RB01299*/ 10920014
 /* PARM_INT_AREA.MSG_VAR_VALUE_6  = CNT_PIC9;                       */ 10930014
 CNT_PIC15                      = PARM_COUNT.INSERTS;                   10940014
 PARM_INT_AREA.MSG_VAR_VALUE_6  = CNT_PIC15;          /* EOC RB01299 */ 10950014
 PARM_INT_AREA.MSG_VAR_CODE_7   = 'UP';                                 10960014
 /* CNT_PIC9                       = PARM_COUNT.UPDATES;/*SOC RB01299*/ 10970014
 /* PARM_INT_AREA.MSG_VAR_VALUE_7  = CNT_PIC9;                       */ 10980014
 CNT_PIC15                      = PARM_COUNT.UPDATES;                   10990014
 PARM_INT_AREA.MSG_VAR_VALUE_7  = CNT_PIC15;          /* EOC RB01299 */ 11000014
 PARM_INT_AREA.MSG_VAR_CODE_8   = 'DL';                                 11010014
 /* CNT_PIC9                       = PARM_COUNT.DELETES;/*SOC RB01299*/ 11020014
 /* PARM_INT_AREA.MSG_VAR_VALUE_8  = CNT_PIC9;                       */ 11030014
 CNT_PIC15                      = PARM_COUNT.DELETES;                   11040014
 PARM_INT_AREA.MSG_VAR_VALUE_8  = CNT_PIC15;          /* EOC RB01299 */ 11050014
 CALL RCB0M1M(PTR_INT_AREA);                                            11060014
 END RCBBUCM_ISSUE_CNT;                                                 11070014
1/********************************************************************/ 11080014
 /*                                                                  */ 11090014
 /* MODULE NAME      : RCBBUCM_ISSUE_INV_COUNT                       */ 11100014
 /*                                                                  */ 11110014
 /* DESCRIPTION      : ISSUE MESSAGE INVALID RECORD COUNT IN FILE    */ 11120014
 /*                    USING RCB0M1M                                 */ 11130014
 /*                                                                  */ 11140014
 /********************************************************************/ 11150014
0RCBBUCM_ISSUE_INV_COUNT: PROC;                                         11160014
0PARM_INT_AREA.MESSAGE_TYPE    = 'IS';                                  11170014
 PARM_INT_AREA.MESSAGE_NUMBER  = '0007';                                11180014
 PARM_INT_AREA.MSG_VAR_CODES   = '';                                    11190014
 PARM_INT_AREA.MSG_VAR_CODE_6  = 'FL';                                  11200014
 PARM_INT_AREA.MSG_VAR_VALUE_6 = WRK_RCBBUC0;                           11210014
 PARM_INT_AREA.MSG_VAR_CODE_7  = 'C7';                                  11220014
 PARM_INT_AREA.MSG_VAR_VALUE_7 = RCBBUC0_TRAILER.CNT_RECS;              11230014
 PARM_INT_AREA.MSG_VAR_CODE_8  = 'C8';                                  11240014
 PARM_INT_AREA.MSG_VAR_VALUE_8 = COUNT.CNT_TOT.ACTIONS;                 11250014
 CALL RCB0M1M (PTR_INT_AREA);                                           11260014
 END RCBBUCM_ISSUE_INV_COUNT;                                           11270014
1/********************************************************************/ 11280014
 /*                                                                  */ 11290014
 /* MODULE NAME      : RCBBUCM_ISSUE_CHKP_LIMIT                      */ 11300014
 /*                                                                  */ 11310014
 /* DESCRIPTION      : ISSUE MESSAGE DEFAULT CHKP LIMIT              */ 11320014
 /*                                                                  */ 11330014
 /********************************************************************/ 11340014
0RCBBUCM_ISSUE_CHKP_LIMIT: PROC;                                        11350014
0PARM_INT_AREA.MESSAGE_TYPE      = 'IS';                                11360014
 PARM_INT_AREA.MESSAGE_NUMBER    = '0008';                              11370014
 PARM_INT_AREA.MSG_VAR_CODES     = ' ';                                 11380014
 WRK_CHKP_LIMIT                  = RCBP12S.CHKP_LIMIT;                  11390014
 PARM_INT_AREA.MSG_VAR_CODE_6    = 'NO';                                11400014
 PARM_INT_AREA.MSG_VAR_VALUE_6   = WRK_CHKP_LIMIT;                      11410014
 CALL RCB0M1M (PTR_INT_AREA);                                           11420014
 END RCBBUCM_ISSUE_CHKP_LIMIT;                                          11430014
1/********************************************************************/ 11440014
 /*                                                                  */ 11450014
 /* MODULE NAME      : RCBBUCM_ISSUE_EMPTY_FILE                      */ 11460014
 /*                                                                  */ 11470014
 /* DESCRIPTION      : ISSUE MESSAGE EMPTY INPUT FILE USING          */ 11480014
 /*                    RCB0M1M                                       */ 11490014
 /*                                                                  */ 11500014
 /********************************************************************/ 11510014
0RCBBUCM_ISSUE_EMPTY_FILE: PROC;                                        11520014
0PARM_INT_AREA.MESSAGE_TYPE    = 'IS';                                  11530014
 PARM_INT_AREA.MESSAGE_NUMBER  = '0013';                                11540014
 PARM_INT_AREA.MSG_VAR_CODES   = '';                                    11550014
 PARM_INT_AREA.MSG_VAR_CODE_6  = 'FL';                                  11560014
 PARM_INT_AREA.MSG_VAR_VALUE_6 = WRK_RCBBUC0;                           11570014
 CALL RCB0M1M (PTR_INT_AREA);                                           11580014
 END RCBBUCM_ISSUE_EMPTY_FILE;                                          11590014
1/********************************************************************/ 11600014
 /*                                                                  */ 11610014
 /* MODULE NAME      : RCBBUCM_ISSUE_INV_HEADER                      */ 11620014
 /*                                                                  */ 11630014
 /* DESCRIPTION      : ISSUE MESSAGE INVALID HEADER IN FILE USING    */ 11640014
 /*                    RCB0M1M                                       */ 11650014
 /*                                                                  */ 11660014
 /********************************************************************/ 11670014
0RCBBUCM_ISSUE_INV_HEADER: PROC;                                        11680014
0PARM_INT_AREA.MESSAGE_TYPE    = 'IS';                                  11690014
 PARM_INT_AREA.MESSAGE_NUMBER  = '0014';                                11700014
 PARM_INT_AREA.MSG_VAR_CODES   = '';                                    11710014
 PARM_INT_AREA.MSG_VAR_CODE_6  = 'FL';                                  11720014
 PARM_INT_AREA.MSG_VAR_VALUE_6 = WRK_RCBBUC0;                           11730014
 CALL RCB0M1M (PTR_INT_AREA);                                           11740014
 END RCBBUCM_ISSUE_INV_HEADER;                                          11750014
1/********************************************************************/ 11760014
 /*                                                                  */ 11770014
 /* MODULE NAME      : RCBBUCM_ISSUE_REC_AFTER                       */ 11780014
 /*                                                                  */ 11790014
 /* DESCRIPTION      : ISSUE MESSAGE RECORDS AFTER TRAILER IN FILE   */ 11800014
 /*                    USING RCB0M1M                                 */ 11810014
 /*                                                                  */ 11820014
 /********************************************************************/ 11830014
0RCBBUCM_ISSUE_REC_AFTER: PROC;                                         11840014
0PARM_INT_AREA.MESSAGE_TYPE    = 'IS';                                  11850014
 PARM_INT_AREA.MESSAGE_NUMBER  = '0015';                                11860014
 PARM_INT_AREA.MSG_VAR_CODES   = '';                                    11870014
 PARM_INT_AREA.MSG_VAR_CODE_6  = 'FL';                                  11880014
 PARM_INT_AREA.MSG_VAR_VALUE_6 = WRK_RCBBUC0;                           11890014
 CALL RCB0M1M (PTR_INT_AREA);                                           11900014
 END RCBBUCM_ISSUE_REC_AFTER;                                           11910014
1/********************************************************************/ 11920014
 /*                                                                  */ 11930014
 /* MODULE NAME      : RCBBUCM_ISSUE_NO_HEADER                       */ 11940014
 /*                                                                  */ 11950014
 /* DESCRIPTION      : ISSUE MESSAGE MISSING HEADER IN FILE USING    */ 11960014
 /*                    RCB0M1M                                       */ 11970014
 /*                                                                  */ 11980014
 /********************************************************************/ 11990014
0RCBBUCM_ISSUE_NO_HEADER: PROC;                                         12000014
0PARM_INT_AREA.MESSAGE_TYPE    = 'IS';                                  12010014
 PARM_INT_AREA.MESSAGE_NUMBER  = '0016';                                12020014
 PARM_INT_AREA.MSG_VAR_CODES   = '';                                    12030014
 PARM_INT_AREA.MSG_VAR_CODE_6  = 'FL';                                  12040014
 PARM_INT_AREA.MSG_VAR_VALUE_6 = WRK_RCBBUC0;                           12050014
 CALL RCB0M1M (PTR_INT_AREA);                                           12060014
 END RCBBUCM_ISSUE_NO_HEADER;                                           12070014
1/********************************************************************/ 12080014
 /*                                                                  */ 12090014
 /* MODULE NAME      : RCBBUCM_ISSUE_NO_TRAILER                      */ 12100014
 /*                                                                  */ 12110014
 /* DESCRIPTION      : ISSUE MESSAGE MISSING TRAILER IN FILE USING   */ 12120014
 /*                    RCB0M1M                                       */ 12130014
 /*                                                                  */ 12140014
 /********************************************************************/ 12150014
0RCBBUCM_ISSUE_NO_TRAILER: PROC;                                        12160014
0PARM_INT_AREA.MESSAGE_TYPE    = 'IS';                                  12170014
 PARM_INT_AREA.MESSAGE_NUMBER  = '0017';                                12180014
 PARM_INT_AREA.MSG_VAR_CODES   = '';                                    12190014
 PARM_INT_AREA.MSG_VAR_CODE_6  = 'FL';                                  12200014
 PARM_INT_AREA.MSG_VAR_VALUE_6 = WRK_RCBBUC0;                           12210014
 CALL RCB0M1M (PTR_INT_AREA);                                           12220014
 END RCBBUCM_ISSUE_NO_TRAILER;                                          12230014
1/********************************************************************/ 12240014
 /*                                                                  */ 12250014
 /* MODULE NAME      : RCBBUCM_ISSUE_INV_REC_TYPE                    */ 12260014
 /*                                                                  */ 12270014
 /* DESCRIPTION      : ISSUE MESSAGE INVALID RECORD TYPE IN FILE     */ 12280014
 /*                    USING RCB0M1M                                 */ 12290014
 /*                                                                  */ 12300014
 /********************************************************************/ 12310014
0RCBBUCM_ISSUE_INV_REC_TYPE: PROC;                                      12320014
0PARM_INT_AREA.MESSAGE_TYPE    = 'IS';                                  12330014
 PARM_INT_AREA.MESSAGE_NUMBER  = '0018';                                12340014
 PARM_INT_AREA.MSG_VAR_CODES   = '';                                    12350014
 PARM_INT_AREA.MSG_VAR_CODE_6  = 'FL';                                  12360014
 PARM_INT_AREA.MSG_VAR_VALUE_6 = WRK_RCBBUC0;                           12370014
 PARM_INT_AREA.MSG_VAR_CODE_7  = 'RT';                                  12380014
 PARM_INT_AREA.MSG_VAR_VALUE_7 = RCBBUC0_RECORD.REC_TYPE;               12390014
 CALL RCB0M1M (PTR_INT_AREA);                                           12400014
 END RCBBUCM_ISSUE_INV_REC_TYPE;                                        12410014
1/********************************************************************/ 12420014
 /*                                                                  */ 12430014
 /* MODULE NAME      : RCBBUCM_ISSUE_INV_ACTION                      */ 12440014
 /*                                                                  */ 12450014
 /* DESCRIPTION      : ISSUE MESSAGE INVALID ACTION USING            */ 12460014
 /*                    RCB0M1M                                       */ 12470014
 /*                                                                  */ 12480014
 /********************************************************************/ 12490014
0RCBBUCM_ISSUE_INV_ACTION: PROC;                                        12500014
0PARM_INT_AREA.MESSAGE_TYPE    = 'IS';                                  12510014
 PARM_INT_AREA.MESSAGE_NUMBER  = '0019';                                12520014
 PARM_INT_AREA.MSG_VAR_CODES   = '';                                    12530014
 PARM_INT_AREA.MSG_VAR_CODE_6  = 'FL';                                  12540014
 PARM_INT_AREA.MSG_VAR_VALUE_6 = WRK_RCBBUC0;                           12550014
 PARM_INT_AREA.MSG_VAR_CODE_7  = 'AC';                                  12560014
 PARM_INT_AREA.MSG_VAR_VALUE_7 = RCBBUC0_RECORD.ACTION_IND;             12570014
 CALL RCB0M1M (PTR_INT_AREA);                                           12580014
 END RCBBUCM_ISSUE_INV_ACTION;                                          12590014
1/********************************************************************/ 12600014
 /*                                                                  */ 12610014
 /* MODULE NAME      : RCBBUCM_ISSUE_ACTION_MESSAGE                  */ 12620014
 /*                                                                  */ 12630014
 /* DESCRIPTION      : ISSUE MESSAGE ACTION ON DATABASE              */ 12640014
 /*                                                                  */ 12650014
 /********************************************************************/ 12660014
0RCBBUCM_ISSUE_ACTION_MESSAGE: PROC;                                    12670014
0PARM_INT_AREA.MESSAGE_TYPE    = 'IS';                                  12680014
 PARM_INT_AREA.MESSAGE_NUMBER  = '0021';                                12690014
 PARM_INT_AREA.MSG_VAR_CODES   = '';                                    12700014
 PARM_INT_AREA.MSG_VAR_CODE_6  = 'AC';                                  12710014
 PARM_INT_AREA.MSG_VAR_VALUE_6 = RCBBUC0_RECORD.ACTION_IND;             12720014
 PARM_INT_AREA.MSG_VAR_CODE_7  = 'DB';                                  12730014
 PARM_INT_AREA.MSG_VAR_VALUE_7 = 'RCBV0475_CTRY_COND';                  12740014
 CALL RCB0M1M (PTR_INT_AREA);                                           12750014
 END RCBBUCM_ISSUE_ACTION_MESSAGE;                                      12760014
1/********************************************************************/ 12770014
 /*                                                                  */ 12780014
 /* MODULE NAME      : RCBBUCM_ISSUE_CHKP_XD                         */ 12790014
 /*                                                                  */ 12800014
 /* DESCRIPTION      : ISSUE MESSAGE STATUS CODE XD                  */ 12810014
 /*                                                                  */ 12820014
 /********************************************************************/ 12830014
0RCBBUCM_ISSUE_CHKP_XD: PROC;                                           12840014
 PARM_INT_AREA.MESSAGE_TYPE    = 'IS';                                  12850014
 PARM_INT_AREA.MESSAGE_NUMBER  = '9998';                                12860014
 PARM_INT_AREA.MSG_VAR_CODES   = '';                                    12870014
 CALL RCB0M1M (PTR_INT_AREA);                                           12880014
 END RCBBUCM_ISSUE_CHKP_XD;                                             12890014
1/********************************************************************/ 12900014
 /*                                                                  */ 12910014
 /* MODULE NAME      : RCBBUCM_ISSUE_SUCCESS                         */ 12920014
 /*                                                                  */ 12930014
 /* DESCRIPTION      : ISSUE MESSAGE SUCCESFULLY ENDED               */ 12940014
 /*                                                                  */ 12950014
 /********************************************************************/ 12960014
0RCBBUCM_ISSUE_SUCCESS: PROC;                                           12970014
 PARM_INT_AREA.MESSAGE_TYPE    = 'IS';                                  12980014
 PARM_INT_AREA.MESSAGE_NUMBER  = '9999';                                12990014
 PARM_INT_AREA.MSG_VAR_CODES   = '';                                    13000014
 CALL RCB0M1M (PTR_INT_AREA);                                           13010014
 END RCBBUCM_ISSUE_SUCCESS;                                             13020014
1/********************************************************************/ 13030014
 /*                                                                  */ 13040014
 /* MODULE NAME      : RCBBUCM_CHKP_RESTART                          */ 13050014
 /*                                                                  */ 13060014
 /* DESCRIPTION      : DETERMINE CHECKPOINT TO RESTART PROGRAM       */ 13070014
 /*                                                                  */ 13080014
 /********************************************************************/ 13090014
0RCBBUCM_CHKP_RESTART: PROC;                                            13100014
0CHKP_CNT_STEPS = 0;                                                    13110014
 CHKP_AREA      = '';                                                   13120014
 CHKP_XRST      = '';                                                   13130014
0CALL PLITDLI (SIX,                                                     13140014
               XRST,                                                    13150014
               PTR_PCB_IO,                                              13160014
               ADDR(CHKP_LEN_IO),                                       13170014
               ADDR(CHKP_XRST),                                         13180014
               ADDR(CHKP_LEN_AREA),                                     13190014
               ADDR(CHKP_AREA));                                        13200014
 SELECT (PCB_IO.ST_CODE);                                               13210014
 WHEN ('');                                                             13220014
 OTHERWISE                                                              13230014
   DO;                                                                  13240014
     CALL RCBBUCM_ERROR (PTR_PCB_IO,                                    13250014
                         'IMS_IO',                                      13260014
                         '#040');                                       13270014
   END;                                                                 13280014
 END;                                                                   13290014
0IF CHKP_XRST.NAME = ' '                                                13300014
 THEN                                                                   13310014
   /******************************************************************/ 13320014
   /*        N O R M A L    S T A R T                                */ 13330014
   /******************************************************************/ 13340014
   DO;                                                                  13350014
0    CHKP_AREA.CNT_NUM          = 1;                                    13360014
     CHKP_AREA.COUNT            = '';                                   13370014
     CHKP_AREA.CTRYNO           = PARM_INT_AREA.COUNTRY_NUMBER;         13380014
     CHKP_ID.NUMBER             = CHKP_AREA.CNT_NUM;                    13390014
0    CALL PLITDLI (SIX,                                                 13400014
                   CHKP,                                                13410014
                   PTR_PCB_IO,                                          13420014
                   ADDR(CHKP_LEN_IO),                                   13430014
                   ADDR(CHKP_ID),                                       13440014
                   ADDR(CHKP_LEN_AREA),                                 13450014
                   ADDR(CHKP_AREA));                                    13460014
     SELECT (PCB_IO.ST_CODE);                                           13470014
     WHEN ('');                                                         13480014
     WHEN ('XD')                                                        13490014
       DO;                                                              13500014
         CALL RCBBUCM_ISSUE_CHKP_XD;                                    13510014
         CALL RCBBUCM_ERROR (PTR_PCB_IO,                                13520014
                             'IMS_IO',                                  13530014
                             '#041');                                   13540014
       END;                                                             13550014
     OTHERWISE                                                          13560014
       DO;                                                              13570014
         CALL RCBBUCM_ERROR (PTR_PCB_IO,                                13580014
                             'IMS_IO',                                  13590014
                             '#042');                                   13600014
       END;                                                             13610014
     END;                                                               13620014
   END;                                                                 13630014
 ELSE                                                                   13640014
   /******************************************************************/ 13650014
   /*                   R E S T A R T                                */ 13660014
   /******************************************************************/ 13670014
   DO;                                                                  13680014
     PARM_INT_AREA.COUNTRY_NUMBER = CHKP_AREA.CTRYNO;                   13690014
     CALL RCBBUCM_READ_FILE_RCBBUC0;    /* READ FIRST DATA RECORD    */ 13700014
   END;                                                                 13710014
 END RCBBUCM_CHKP_RESTART;                                              13720014
1/********************************************************************/ 13730014
 /*                                                                  */ 13740014
 /* MODULE NAME      : RCBBUCM_CHKP_ISSUE                            */ 13750014
 /*                                                                  */ 13760014
 /* DESCRIPTION      : ISSUE CHECKPOINT, COMMITTING ALL CHANGES      */ 13770014
 /*                    TO THE DATABASES (SYMBOLIC)                   */ 13780014
 /*                                                                  */ 13790014
 /********************************************************************/ 13800014
0RCBBUCM_CHKP_ISSUE: PROC;                                              13810014
0CHKP_AREA.CNT_NUM       = CHKP_AREA.CNT_NUM + 1;                       13820014
 CHKP_ID.NUMBER          = CHKP_AREA.CNT_NUM;                           13830014
 CHKP_AREA.CTRYNO        = PARM_INT_AREA.COUNTRY_NUMBER;                13840014
0CALL PLITDLI (SIX,                                                     13850014
               CHKP,                                                    13860014
               PTR_PCB_IO,                                              13870014
               ADDR(CHKP_LEN_IO),                                       13880014
               ADDR(CHKP_ID),                                           13890014
               ADDR(CHKP_LEN_AREA),                                     13900014
               ADDR(CHKP_AREA));                                        13910014
 SELECT (PCB_IO.ST_CODE);                                               13920014
 WHEN ('')                                                              13930014
   DO;                                                                  13940014
     CHKP_CNT_STEPS = 0;                                                13950014
   END;                                                                 13960014
 WHEN ('XD')                                                            13970014
   DO;                                                                  13980014
     CALL RCBBUCM_ISSUE_CHKP_XD;                                        13990014
     CALL RCBBUCM_ERROR (PTR_PCB_IO,                                    14000014
                         'IMS_IO',                                      14010014
                         '#043');                                       14020014
   END;                                                                 14030014
 OTHERWISE                                                              14040014
   DO;                                                                  14050014
     CALL RCBBUCM_ERROR (PTR_PCB_IO,                                    14060014
                         'IMS_IO',                                      14070014
                         '#044');                                       14080014
   END;                                                                 14090014
 END;                                                                   14100014
0CALL RCBBUCM_LOCK_TABLE;   /* RE-LOCK THE TABLE AFTER A CHECK POINT */ 14110014
 END RCBBUCM_CHKP_ISSUE;                                                14120014
1/********************************************************************/ 14130014
 /*                                                                  */ 14140014
 /* MODULE NAME      : RCBBUCM_ERROR                                 */ 14150014
 /*                                                                  */ 14160014
 /* DESCRIPTION      : CALLS THE COMMON ERROR ROUTINE AFTER FILLING  */ 14170014
 /*                    THE INPUT VARIABLES                           */ 14180014
 /*                                                                  */ 14190014
 /********************************************************************/ 14200014
0RCBBUCM_ERROR: PROC     (PTR_ERROR,                                    14210014
                          ERR_TYPE,                                     14220014
                          CALL_ID);                                     14230014
0DCL PTR_ERROR    PTR;                                                  14240014
 DCL ERR_TYPE     CHAR(8);                                              14250014
 DCL CALL_ID      CHAR(4);                                              14260014
0PARM_INT_AREA.PTR_ERROR      = PTR_ERROR;                              14270014
 PARM_INT_AREA.ERR_TYPE       = ERR_TYPE;                               14280014
 PARM_INT_AREA.CALL_ID        = CALL_ID;                                14290014
0CALL RCB0E1M (PTR_INT_AREA);                                           14300014
 END RCBBUCM_ERROR;                                                     14310014
1/*******************************************************************/  14320014
 /*DO NOT CHANGE THIS PART, IT IS MEANT FOR ABR                     */  14330014
 /*******************************************************************/  14340014
0%INCLUDE DAIFPLH ;                      /* COMPILE DATE/TIME STAMP */  14350014
 $DAIMOD (RCBBUCM);                      /* MODULE TO BE COMPILED   */  14360014
0/*******************************************************************/  14370014
 /* END OF ABR BLOCK                                                */  14380014
 /*******************************************************************/  14390014
0END RCBBUCM;                                                           14400014